--- 
title: "现代统计图形（第二版）"
author: "黄湘云"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
papersize: b5
fontsize: 10pt
graphics: yes
colorlinks: yes
lot: yes
lof: yes
geometry:
  - tmargin=2.5cm
  - bmargin=2.5cm
  - lmargin=3.0cm
  - rmargin=2.0cm
classoption: "UTF8,twoside,openany,table"
hyperrefoptions:
  - linktoc=all
  - pdfstartview=FitH
  - bookmarksnumbered=true
link-citations: yes
bibliography: 
  - book.bib
url: https://bookdown.org/xiangyun/msg2
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  现代统计图形（第二版）.
biblio-style: gb7714-2015ay
biblatexoptions: 
  - backend=biber
  - gbpub=true
csl: china-national-standard-gb-t-7714-2015-author-date.csl
---


# 欢迎 {#welcome .unnumbered}

::: {.rmdwarning data-latex="{警告}"}
本书是《现代统计图形》[@msg2021] 的后续第二版，尚处于草创阶段，欢迎大家参与。
:::

书中的代码字体采用美观的 [Source Code Pro](https://ctan.org/pkg/sourcecodepro) 字体，
为方便跨操作系统编译书籍电子版，正文的中文字体采用开源的 [fandol](https://ctan.org/pkg/fandol) 字体。
而本书图形中使用的 Noto 系列中英文字体来自 [Google Fonts 字体库](https://fonts.google.com/)，分别是 Noto Sans 无衬线英文字体和 Noto Serif SC 宋体中文字体。图\@ref(fig:noto-fonts) 中的左、右子图分别展示 Base R 和 ggplot2 图形中中英文字体的效果。在图形中调用中文字体分两步走，先使用 **sysfonts** 包获取并注册 Noto 相关字体，然后在绘图的时候指定字体，并在代码块选项中启用 `fig.showtext=TRUE`，这样就能在 R Markdown 环境中优雅地绘制含中文的图形。如果在 R Console 中绘图则需加载 **showtext** 包，运行函数 `showtext_auto()`。

```{r noto-fonts, fig.cap="中英文字体设置", fig.subcap=c('Base R 图形', 'ggplot2 图形'), out.width='50%', fig.width=4.5, fig.height=3.5, fig.align='center', fig.alt='汞蒸气的压力随温度的指数级变化', fig.showtext=TRUE, fig.ncol=2}
# 准备 Noto 中英文字体
sysfonts::font_add_google(name = "Noto Sans")
sysfonts::font_add_google(name = "Noto Serif SC")
# 在 Base R 图形中使用 Noto 字体
par(mar = c(4, 4, .2, .1), family = "Noto Sans")
plot(pressure, type = 'b', pch = 19, ann = FALSE)
title(xlab = "温度", ylab = "压力", family = "Noto Serif SC")
# 在 ggplot2 图形中使用 Noto 字体
library(ggplot2)
ggplot(data = pressure, aes(x = temperature, y = pressure)) +
  geom_line() +
  geom_point() +
  labs(x = "温度", y = "压力") +
  scale_x_continuous(breaks = seq(0, 400, by = 50)) +
  theme_bw(base_size = 13) +
  theme(
    axis.title = element_text(family = "Noto Serif SC"),
    axis.title.x = element_text(
      margin = margin(b = 0, l = 0, t = 20, r = 0)
    ),
    axis.title.y = element_text(
      margin = margin(b = 0, l = 0, t = 0, r = 20)
    ),
    panel.grid = element_blank(),
    axis.text.x = element_text(family = "Noto Sans"),
    axis.text.y = element_text(
      angle = 90, vjust = 1.5, hjust = 0.5,
      family = "Noto Sans"
    )
  )
```

::: {.rmdnote data-latex="{注意}"}
为方便测试贡献者提供的 PR，本书托管在 Github 上，同时启用 Github Action 服务。书中使用的 Noto 系列字体来自 Google 字体网站，国内可能无法访问，但为了尽可能减少可重复的成本，保持书籍能够在 MacOS、Windows 和 Linux 等系统上顺利编译，字体要尽可能便携易得，此外，考虑到美观性，以及避免仓库中附带字体可能带来的权限问题，因此，在绘图程序中使用了 Noto 字体，暂时没有更好的办法。
:::

考虑到要同时支持 PDF 和 HTML 两种书籍格式，书中制作表格采纳 **knitr** 和 **kableExtra** 的能力，为简单起见，提供一个迷你的表格样式示例，如表 \@ref(tab:iris-tab) 所示。

```{r iris-tab}
library(knitr)
library(kableExtra)
kable(head(iris), caption = "iris 数据集（部分）", booktabs = TRUE) |> 
  kable_classic()
```


## 软件信息 {#session .unnumbered}

本书写作过程中，依赖 **knitr** [@xie2015]、**rmarkdown** [@xie2018; @xie2020] 和 **bookdown** [@xie2016]，书籍在 `r R.version.string` 下编译，最新一次编译时间是 `r format(Sys.time(), tz = "Asia/Shanghai")`，其它使用的 R 包如下。

```{r}
xfun::session_info(packages = c(
  "knitr", "rmarkdown", "bookdown", "ggplot2", "kableExtra", "showtext"
), dependencies = FALSE)
```
